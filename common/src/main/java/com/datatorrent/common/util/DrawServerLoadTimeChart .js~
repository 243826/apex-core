/*
 *  Copyright (c) 2012-2013 Malhar, Inc.
 *  All Rights Reserved.
 */

/**
 * Functions for drawing server load vs time chart.
 * @author Dinesh Prasad (dinesh@malhar-inc.com) 
 */

/*
function PageViewTimeDataUrl()
{    
    var url = "/PageViewTimeData.php?";
    url += "from=";
    url += Math.floor(pageViewLookback);
    if (pageViewUrl) 
    {
       url += "&url=" + pageViewUrl;   
    }
    //url += "&url=mydomain.com/services.php?serviceid=6";
    return url;  
}

function RenderPageViewTimeChart()
{
  // create/delete rows 
  if (pageViewTable.getNumberOfRows() < pageDataPoints.length)
  {    
    var numRows = pageDataPoints.length - pageViewTable.getNumberOfRows();
    pageViewTable.addRows(numRows);
  } else {
    for(var i=(pageViewTable.getNumberOfRows()-1); i >= pageDataPoints.length; i--)
    {
      pageViewTable.removeRow(i);    
    }
  }

  // Populate data table with time/cost data points. 
  for(var i=0; i < pageViewTable.getNumberOfRows(); i++)
  {
    //if(parseFloat(aggrDataPoints[i].cost) < 500) continue;
    pageViewTable.setCell(i, 0, new Date(parseInt(pageDataPoints[i].timestamp)));
    pageViewTable.setCell(i, 1, parseFloat(pageDataPoints[i].view));
  }

  // Draw line chart.
  var options = { width: 600, height: 300, legend: 'none', pointSize: 0, lineWidth : 1 };
  options.title = 'Page View vs Time Chart';
  pageViewChart.draw(PageViewView, options); 
}

function DrawPageViewTimeChart()
{
  var url = PageViewTimeDataUrl();
  try
  {
    var connect = new XMLHttpRequest();
    connect.onreadystatechange = function() {
      if(connect.readyState==4 && connect.status==200) {
        pageViewData = connect.response;
        var pts = JSON.parse(pageViewData);
        for(var i=0; i <  pts.length; i++) pageDataPoints.push(pts[i]);
        sortByKey(pageDataPoints, "timestamp");
	var cuttime = new Date().getTime() - parseInt(params['lookback']) * 3600 * 1000;
        var count = 0;
        for(var i=0; i < pageDataPoints.length; i++)
        {
          if(parseInt(pageDataPoints[i].timestamp)  < cuttime) count++;
          else break;
        }
        pageDataPoints.splice(0, count);
        RenderPageViewTimeChart();
      }
    }
    connect.open('GET',  url, true);
    connect.send(null);
  } catch(e) {
  }
  pageViewLookback = (new Date().getTime()/1000)-pageViewRefresh;
}

*/

function HandleServerLoadTimeSubmit()
{
  // get submit values 
 // serverName = document.getElementById('servername').value;
    alert('got here');
 /* serverLoadRefresh = document.getElementById('serverloadrefresh').value;
  if ( !serverLoadRefresh || (serverLoadRefresh == "")) serverLoadRefresh = 5;
  serverLoadLookback = document.getElementById('serverloadlookback').value;
  if ( !serverLoadLookback || (serverLoadLookback == "")) {
    serverLoadLookback = (new Date().getTime()/1000) - 3600;
  }  else {
    serverLoadLookback = (new Date().getTime()/1000) - 3600 * serverLoadLookback;
  }

  // set from values  
  document.getElementById('serverloadrefresh').value = serverLoadRefresh;
  var lookback = document.getElementById('serverloadlookback').value;
  document.getElementById('serverloadlookback').value = lookback;

  // draw chart
  //DrawPageViewTimeChart();
  //setInterval(DrawPageViewTimeChart, pageViewRefresh * 1000);*/
}
